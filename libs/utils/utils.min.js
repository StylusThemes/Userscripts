// ==UserScript==
// @author       Journey Over
// @exclude      *
// ==UserLibrary==
// @name         @journeyover/utils
// @description  Utility helpers for my userscripts
// @license      MIT
// @version      1.0.2
// @homepageURL  https://github.com/StylusThemes/Userscripts
// ==/UserScript==

function debounce(fn,wait){let timeoutId=null;return function(...args){if(timeoutId)clearTimeout(timeoutId);const context=this;timeoutId=setTimeout(()=>fn.apply(context,args),wait)}}function Logger(prefix,opts={}){const baseStyle="font-weight: bold; padding:2px 6px; border-radius: 4px;";const formattedPrefix=`[${prefix}]`;const styles={log:"background: #4caf50; color: white;"+baseStyle,error:"background: #f44336; color: white;"+baseStyle,warn:"background: #ff9800; color: black;"+baseStyle,debug:"background: #2196f3; color: white;"+baseStyle};const icons={log:"‚úÖ",error:"‚ùå",warn:"‚ö†Ô∏è",debug:"üîç"};function format(type,message,...rest){console[type](`%c${icons[type]} ${formattedPrefix}%c ${message}`,styles[type],"",...rest)}function log(message,...rest){format("log",message,...rest)}log.error=function(message,...rest){format("error",message,...rest)};log.warn=function(message,...rest){format("warn",message,...rest)};log.debug=function(message,...rest){if(opts.debug){format("debug",message,...rest)}};log.debugEnabled=!!opts.debug;return log}function qs(sel,root=document){return root.querySelector(sel)}function qsa(sel,root=document){return[...root.querySelectorAll(sel)]}function isVisible(el){if(!el)return false;const style=getComputedStyle(el);return el.offsetParent!==null&&style.visibility!=="hidden"&&style.display!=="none"&&style.opacity!=="0"}function findTargetInput(container=null){let target=qs("#query");if(target&&isVisible(target))return target;if(container){target=container.querySelector("input, textarea");if(target&&isVisible(target))return target}const candidates=qsa("input, textarea");target=candidates.find(isVisible)||null;return target}function getNativeValueSetter(el){const proto=el instanceof HTMLInputElement?HTMLInputElement.prototype:HTMLTextAreaElement.prototype;const desc=Object.getOwnPropertyDescriptor(proto,"value");return desc&&desc.set}function setInputValueReactive(el,value){const nativeSetter=getNativeValueSetter(el);if(nativeSetter){nativeSetter.call(el,value)}else{el.value=value}try{el.focus();if(typeof el.setSelectionRange==="function")el.setSelectionRange(value.length,value.length)}catch(err){}el.dispatchEvent(new Event("input",{bubbles:true}));el.dispatchEvent(new Event("change",{bubbles:true}));try{if(el._valueTracker?.setValue){el._valueTracker.setValue(value)}}catch(err){}}function ready(fn){if(document.readyState!=="loading"){fn()}else{document.addEventListener("DOMContentLoaded",fn)}}if(typeof module!=="undefined"&&module.exports){module.exports={debounce:debounce,Logger:Logger,qs:qs,qsa:qsa,isVisible:isVisible,findTargetInput:findTargetInput,getNativeValueSetter:getNativeValueSetter,setInputValueReactive:setInputValueReactive,ready:ready}}if(typeof window!=="undefined"){window.debounce=debounce;window.Logger=Logger;window.qs=qs;window.qsa=qsa;window.isVisible=isVisible;window.findTargetInput=findTargetInput;window.getNativeValueSetter=getNativeValueSetter;window.setInputValueReactive=setInputValueReactive;window.ready=ready}
