// ==UserScript==
// @author       Journey Over
// @exclude      *
// ==UserLibrary==
// @name         @journeyover/utils
// @description  Utility helpers for my userscripts
// @license      MIT
// @version      1.0.3
// @homepageURL  https://github.com/StylusThemes/Userscripts
// ==/UserScript==

function debounce(callback,wait){let timeoutId=null;return function(...arguments_){if(timeoutId)clearTimeout(timeoutId);const context=this;timeoutId=setTimeout(()=>callback.apply(context,arguments_),wait)}}function Logger(prefix,options={}){const baseStyle='font-weight: bold; padding:2px 6px; border-radius: 4px;';const formattedPrefix=`[${prefix}]`;const styles={log:'background: #4caf50; color: white;'+baseStyle,error:'background: #f44336; color: white;'+baseStyle,warn:'background: #ff9800; color: black;'+baseStyle,debug:'background: #2196f3; color: white;'+baseStyle};const icons={log:'‚úÖ',error:'‚ùå',warn:'‚ö†Ô∏è',debug:'üîç'};function format(type,message,...rest){console[type](`%c${icons[type]} ${formattedPrefix}%c ${message}`,styles[type],'',...rest)}function log(message,...rest){format('log',message,...rest)}log.error=function(message,...rest){format('error',message,...rest)};log.warn=function(message,...rest){format('warn',message,...rest)};log.debug=function(message,...rest){if(options.debug){format('debug',message,...rest)}};log.debugEnabled=!!options.debug;return log}function qs(sel,root=document){return root.querySelector(sel)}function qsa(sel,root=document){return[...root.querySelectorAll(sel)]}function isVisible(element){if(!element)return false;const style=getComputedStyle(element);return element.offsetParent!==null&&style.visibility!=='hidden'&&style.display!=='none'&&style.opacity!=='0'}function findTargetInput(container=null){let target=qs('#query');if(target&&isVisible(target))return target;if(container){target=container.querySelector('input, textarea');if(target&&isVisible(target))return target}const candidates=qsa('input, textarea');target=candidates.find(isVisible)||null;return target}function getNativeValueSetter(element){const proto=element instanceof HTMLInputElement?HTMLInputElement.prototype:HTMLTextAreaElement.prototype;const desc=Object.getOwnPropertyDescriptor(proto,'value');return desc&&desc.set}function setInputValueReactive(element,value){const nativeSetter=getNativeValueSetter(element);if(nativeSetter){nativeSetter.call(element,value)}else{element.value=value}try{element.focus();if(typeof element.setSelectionRange==='function')element.setSelectionRange(value.length,value.length)}catch{}element.dispatchEvent(new Event('input',{bubbles:true}));element.dispatchEvent(new Event('change',{bubbles:true}));try{if(element._valueTracker?.setValue){element._valueTracker.setValue(value)}}catch{}}function ready(callback){if(document.readyState!=='loading'){callback()}else{document.addEventListener('DOMContentLoaded',callback)}}if(typeof module!=='undefined'&&module.exports){module.exports={debounce:debounce,Logger:Logger,qs:qs,qsa:qsa,isVisible:isVisible,findTargetInput:findTargetInput,getNativeValueSetter:getNativeValueSetter,setInputValueReactive:setInputValueReactive,ready:ready}}if(typeof window!=='undefined'){window.debounce=debounce;window.Logger=Logger;window.qs=qs;window.qsa=qsa;window.isVisible=isVisible;window.findTargetInput=findTargetInput;window.getNativeValueSetter=getNativeValueSetter;window.setInputValueReactive=setInputValueReactive;window.ready=ready}
